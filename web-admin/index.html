<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Admin Panel</title>
    <style>
      body {
        display: flex;
        flex-direction: row;
      }

      header {
        margin: 1em;
      }
    </style>
    <div id="alertContainer"></div>
    <style>
      .alert {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1;
        padding: 1vh 2vh;
        margin-bottom: 1rem;
        border: 2px solid transparent;
        text-transform: capitalize;
        border-radius: 5px;
        transition: 0.3s ease-in-out;
      }

      #graphSelect {
        padding: 1vh;
        border: 1px solid lightgrey;
        border-radius: 1vh;
        text-transform: uppercase;
      }

      .alert.success {
        color: #fff;
        background-color: green;
        border-color: #fff;
      }
      .alert.danger {
        color: #fff;
        background-color: maroon;
        border-color: #fff;
      }
    </style>
    <script>
      function showAlert(message, type) {
        const alertContainer = document.getElementById("alertContainer");

        const alert = document.createElement("div");
        alert.className = `alert ${type}`;
        alert.innerHTML = `${message}<span class="close" onclick="closeAlert(this)"> &#9587;</span>`;

        alertContainer.appendChild(alert);

        setTimeout(() => {
          closeAlert(alert.querySelector(".close"));
        }, 4000);
      }

      function closeAlert(closeButton) {
        const alert = closeButton.parentElement;
        alert.style.display = "none";
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li class="logo">
            <img src="/assets/ww side name logo.png" alt="" />
            <span class="nav-item admin">Admin Dashboard</span>
          </li>
          <li>
            <a href="#" onclick="selectSection('users')" id="usersTab">
              <i class="fas fa-user"></i>
              <span class="nav-item">users</span>
            </a>
          </li>
          <li>
            <a
              href="#"
              onclick="selectSection('collections')"
              id="collectionsTab"
            >
              <i class="fas fa-user"></i>
              <span class="nav-item">collections</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="selectSection('addProducts')" id="productsTab">
              <i class="fas fa-user"></i>
              <span class="nav-item">products</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="selectSection('inventory')" id="inventoryTab">
              <i class="fas fa-warehouse"></i>
              <span class="nav-item">Inventory</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="selectSection('coupons')" id="couponTab">
              <i class="fas fa-gift"></i>
              <span class="nav-item">Coupons</span>
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <main>
      <div id="users">
        <div>
          <h1>
            User Analytics
            <button class="export-btn">
              Export CSV
              <iconify-icon icon="ic:baseline-file-download"></iconify-icon>
            </button>
          </h1>
          <div class="user-container">
            <table class="user-table">
              <thead>
                <tr>
                  <th>User Name</th>
                  <th>Email</th>
                  <th>Phone Number</th>
                  <th>Pin Code</th>
                  <th>Account Created</th>
                </tr>
              </thead>
              <tbody id="userTableBody"></tbody>
            </table>
          </div>
        </div>

        <script>
          document
            .querySelector(".export-btn")
            .addEventListener("click", function () {
              exportToCSV("user-table.csv");
            });

          async function exportToCSV(filename) {
            const table = document.querySelector(".user-table");
            const rows = Array.from(table.querySelectorAll("tr"));

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += rows
              .map((row) => {
                const rowData = Array.from(row.children)
                  .map((cell) => cell.textContent)
                  .join(",");
                return rowData;
              })
              .join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
          }

          document
            .querySelector("#usersTab")
            .addEventListener("click", async () => {
              function createTableCell(content) {
                let cell = document.createElement("td");
                cell.textContent = content;
                return cell;
              }
              document.querySelector("#userTableBody").innerHTML = "";
              await axios
                .get("/api/admin/getAllUsers")
                .then((response) => response.data)
                .then((users) => {
                  users.forEach((user) => {
                    let row = document.createElement("tr");
                    row.append(createTableCell(user.name || "N/A"));
                    row.append(createTableCell(user.email || "N/A"));
                    row.append(createTableCell(user.phone || "N/A"));
                    row.append(createTableCell(user.pincode || "N/A"));

                    const dateTime = new Date(user.joinDate || "N/A");
                    const formattedDateTime = dateTime.toLocaleString();
                    row.append(createTableCell(formattedDateTime));
                    document.querySelector("#userTableBody").append(row);
                    showAlert("All users loaded successfully", "success");
                  });
                })
                .catch((err) =>
                  showAlert(
                    "Oops, an error occurred while fetching users",
                    "danger"
                  )
                );
            });
        </script>
      </div>
      <div id="collections" style="display: none">
        <div>
          <button id="collectionsCreate">Create New</button>
          <form id="collectionsForm" style="display: none">
            <input type="text" id="collectionName" placeholder="Name" />
            <input
              type="text"
              id="collectionDescription"
              placeholder="Description"
            />
            <button id="collectionsEnter">Enter</button>
            <button id="collectionsCancel">Cancel</button>
          </form>
          <table>
            <thead>
              <th>Name</th>
              <th>Description</th>
            </thead>
            <tbody id="collectionsTableBody"></tbody>
          </table>
        </div>
        <script>
          let collectionsEditMode = false;
          let collectionsEditId = "";

          document
            .getElementById("collectionsEnter")
            .addEventListener("click", () => {
              const name = document.getElementById("collectionName").value;
              const description = document.getElementById(
                "collectionDescription"
              ).value;

              if (collectionsEditMode) {
                axios
                  .put("/collections/" + collectionsEditId, {
                    name,
                    description,
                  })
                  .then((response) => {
                    collectionsEditId = "";
                    collectionsEditMode = false;
                    showAlert("collection updated successfully", "success");

                    loadCollections();
                  })
                  .catch((err) => console.log(err));
              } else {
                axios
                  .post("/collections", { name, description })
                  .then((response) => {
                    showAlert("collection created successfully", "success");
                    loadCollections();
                  })
                  .catch((err) => console.log(err));
              }
            });

          document
            .getElementById("collectionsCreate")
            .addEventListener("click", (event) => {
              event.preventDefault();

              document.getElementById("collectionsCreate").style.display =
                "none";
              document.getElementById("collectionsForm").style.display =
                "block";
            });
          document
            .getElementById("collectionsCancel")
            .addEventListener("click", (event) => {
              collectionsEditMode = false;
              collectionsEditId = "";

              event.preventDefault();
              document.getElementById("collectionsCreate").style.display =
                "block";
              document.getElementById("collectionsForm").style.display = "none";
            });

          async function loadCollections() {
            await axios
              .get("/collections")
              .then((response) => {
                const data = response.data;

                document.getElementById("collectionsTableBody").innerHTML = "";
                data.forEach((element) => {
                  let row = document.createElement("tr");

                  let name = document.createElement("td");
                  name.textContent = element.name;
                  row.append(name);

                  let description = document.createElement("td");
                  description.textContent = element.description;
                  row.append(description);

                  let edit = document.createElement("button");
                  edit.textContent = "edit";
                  edit.addEventListener("click", () => {
                    collectionsEditId = element._id;
                    collectionsEditMode = true;

                    document.getElementById("collectionsCreate").style.display =
                      "none";
                    document.getElementById("collectionsForm").style.display =
                      "block";
                    document.getElementById("collectionName").value =
                      element.name;
                    document.getElementById("collectionDescription").value =
                      element.description;
                  });
                  row.append(edit);

                  let deleteButton = document.createElement("button");
                  deleteButton.textContent = "delete";
                  deleteButton.addEventListener("click", () => {
                    axios
                      .delete("/collections/" + element._id)
                      .then(async (response) => {
                        showAlert("collection deleted successfully", "success");
                        loadCollections();
                      })
                      .catch((err) => console.log(err));
                  });
                  row.append(deleteButton);

                  document.getElementById("collectionsTableBody").append(row);
                });
              })
              .catch((err) => console.log(err));
          }
          document
            .getElementById("collectionsTab")
            .addEventListener("click", loadCollections());
        </script>
      </div>
      <div id="addProducts" style="display: none">
        <div>
          <h1 style="margin-bottom: 0.3rem">Add Product</h1>
          <div class="form-container" style="overflow-y: scroll">
            <div>
              <label for="productName">Product Name:</label>
              <input type="text" id="productName" name="productName" required />

              <label for="productDescription">Product Description:</label>
              <textarea
                id="productDescription"
                name="productDescription"
                rows="4"
                required
              ></textarea>

              <label for="originalPrice">Original Price (₹):</label>
              <input
                type="number"
                id="originalPrice"
                name="originalPrice"
                required
              />

              <label for="offeredPrice"
                >Offered Price (₹)<span style="color: #999"
                  >(Amount to be displayed to User)</span
                >:</label
              >
              <input
                type="number"
                id="offeredPrice"
                name="offeredPrice"
                required
              />

              <label for="ProductSKUcode">Product SKU Code:</label>
              <input type="text" id="ProductSKUcode" name="ProductSKUcode" />

              <label for="category">Category :</label>

              <select id="category" name="category" required>
                <option value="Face Care">Face Care</option>
                <option value="Hair Care">Hair Care</option>
                <option value="Body Care">Body Care</option>
                <option value="Beard Care">Beard Care</option>
                <option value="Skin Care">Skin Care</option>
              </select>

              <label for="productFAQ">FAQ :</label>
              <textarea
                id="productFAQ"
                name="productFAQ"
                rows="3"
                required
              ></textarea>

              <label for="keyFeatures">Key Features :</label>
              <textarea
                id="keyFeatures"
                name="keyFeatures"
                rows="3"
                required
              ></textarea>

              <label for="howtouse">How To Use :</label>
              <textarea
                id="howtouse"
                name="howtouse"
                rows="3"
                required
              ></textarea>

              <label for="metaTitle">Meta Title :</label>
              <textarea
                id="metaTitle"
                name="metaTitle"
                rows="1"
                required
              ></textarea>

              <label for="metaDescription">Meta Description:</label>
              <textarea
                id="metaDescription"
                name="metaDescription"
                rows="3"
                required
              ></textarea>

              <button
                onclick="addProduct()"
                style="margin-top: 3vh; margin-bottom: 3vh"
              >
                Publish Product
              </button>

              <button onclick="scheduleProduct()" class="schedule-product">
                Schedule Product
              </button>
            </div>
            <div>
              <label for="stock">Stock:</label>
              <input type="number" id="stock" name="stock" required />

              <label for="new-arrival">New Arrival:</label>
              <div>
                <input
                  type="radio"
                  id="yes"
                  name="newArrival"
                  value="true"
                  checked
                />
                <label for="yes" style="margin-top: -2vh">Yes</label>

                <input type="radio" id="no" name="newArrival" value="false" />
                <label for="no">No</label>
              </div>

              <label for="best-seller">Best Quality:</label>
              <div>
                <input
                  type="radio"
                  id="yes"
                  name="bestSeller"
                  value="true"
                  checked
                />
                <label for="yes">Yes</label>

                <input type="radio" id="no" name="bestSeller" value="false" />
                <label for="no">No</label>
              </div>

              <label for="Image1">Main Image (250x250):</label>
              <input
                type="file"
                value="-1"
                id="Image1"
                name="Image1"
                accept="image/*"
                required
                onchange="previewImage('Image1')"
                style="border: none; padding: 0.5rem; background-color: #f0f0f0"
              />
              <img
                id="Image1Preview"
                alt="Preview"
                style="
                  width: 20%;
                  height: 15vh;
                  margin-top: 0rem;
                  margin-bottom: 1rem;
                  border-radius: 1rem;
                "
              />

              <div class="addon-images">
                <div class="img2">
                  <label for="Image2">2nd Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image2"
                    name="Image2"
                    accept="image/*"
                    required
                    onchange="previewImage('Image2')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image2Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>

                <div class="img2">
                  <label for="Image3">3rd Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image3"
                    name="Image3"
                    accept="image/*"
                    required
                    onchange="previewImage('Image3')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image3Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>

                <div class="img2">
                  <label for="Image4">4th Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image4"
                    name="Image4"
                    accept="image/*"
                    required
                    onchange="previewImage('Image4')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image4Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>

                <div class="img2">
                  <label for="Image5">5th Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image5"
                    name="Image5"
                    accept="image/*"
                    required
                    onchange="previewImage('Image5')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image5Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>

                <div class="img2">
                  <label for="Image6">6th Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image6"
                    name="Image6"
                    accept="image/*"
                    required
                    onchange="previewImage('Image6')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image6Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>

                <div class="img2">
                  <label for="Image7">7th Image (250x250):</label>
                  <input
                    type="file"
                    value="-1"
                    id="Image7"
                    name="Image7"
                    accept="image/*"
                    required
                    onchange="previewImage('Image7')"
                    style="
                      border: none;
                      padding: 0.5rem;
                      background-color: #f0f0f0;
                    "
                  />
                  <img
                    id="Image7Preview"
                    alt="Preview"
                    style="
                      width: 70%;
                      height: auto;
                      margin-top: 0rem;
                      margin-bottom: 1rem;
                      border-radius: 1rem;
                    "
                  />
                </div>
              </div>
            </div>
          </div>
          <div
            id="scheduleModal"
            class="item_schedule_modal"
            style="display: none"
          >
            <div class="modal-content">
              <span
                class="close"
                onclick="closeScheduleModal()"
                style="
                  cursor: pointer;
                  position: absolute;
                  top: 1vh;
                  right: 1vh;
                "
                >&#9587;</span
              >
              <h2>Schedule Product</h2>
              <div>
                <label for="scheduleDate">Scheduled Date:</label>
                <input
                  type="date"
                  id="scheduleDate"
                  name="scheduleDate"
                  required
                />
                <span id="scheduleDateError" class="error-message"></span>
              </div>
              <div>
                <label for="scheduleTime">Scheduled Time:</label>
                <input
                  type="time"
                  id="scheduleTime"
                  name="scheduleTime"
                  required
                />
                <span id="scheduleTimeError" class="error-message"></span>
              </div>

              <button onclick="addProduct()">Schedule Product</button>
            </div>
          </div>
          <script>
            function setScheduledDateTime() {
              const now = new Date();
              const currentDate = now.toISOString().split("T")[0];
              const currentHours = ("0" + now.getHours()).slice(-2);
              const currentMinutes = ("0" + now.getMinutes()).slice(-2);
              const currentTime = `${currentHours}:${currentMinutes}`;
              document.getElementById("scheduleDate").value = currentDate;
              document.getElementById("scheduleTime").value = currentTime;
            }
            function getScheduledDateTime() {
              const scheduleDateInput =
                document.getElementById("scheduleDate").value;
              const scheduleTimeInput =
                document.getElementById("scheduleTime").value;
              const combinedDateTimeString =
                scheduleDateInput + "T" + scheduleTimeInput;
              const scheduledDateTime = new Date(combinedDateTimeString);
              if (isNaN(scheduledDateTime.getTime())) {
                document.getElementById("scheduleDateError").innerText =
                  "Invalid date and time";
              } else {
                document.getElementById("scheduleDateError").innerText = "";
                console.log("Scheduled Date and Time:", scheduledDateTime);
                return scheduledDateTime;
              }
            }
            function scheduleProduct() {
              setScheduledDateTime();
              var modal = document.getElementById("scheduleModal");
              modal.style.display = "flex";
            }
            function closeScheduleModal() {
              var modal = document.getElementById("scheduleModal");
              modal.style.display = "none";
            }
          </script>
        </div>

        <script>
          function previewImage(inputId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(`${inputId}Preview`);

            if (input.files && input.files[0]) {
              const reader = new FileReader();

              reader.onload = function (e) {
                preview.src = e.target.result;
              };

              reader.readAsDataURL(input.files[0]);
            }
          }

          function resetPreview() {
            document.getElementById("Image1Preview").src = "";
            document.getElementById("Image2Preview").src = "";
            document.getElementById("Image3Preview").src = "";
            document.getElementById("Image4Preview").src = "";
            document.getElementById("Image5Preview").src = "";
            document.getElementById("Image6Preview").src = "";
            document.getElementById("Image7Preview").src = "";
          }
          async function addProduct() {
            let bestSeller = false;

            document.getElementsByName("bestSeller").forEach((button) => {
              if (button.checked) {
                bestSeller = Boolean(button.value);
              }
            });

            let newArrival = false;

            document.getElementsByName("newArrival").forEach((button) => {
              if (button.checked) {
                newArrival = Boolean(button.value);
              }
            });

            const name = document.getElementById("productName").value;
            const description =
              document.getElementById("productDescription").value;

            const skuCode = document.getElementById("ProductSKUcode").value;

            const FAQ = document.getElementById("productFAQ").value;
            const metaTitle = document.getElementById("metaTitle").value;
            const metaDescription =
              document.getElementById("metaDescription").value;
            const keyFeatures = document.getElementById("keyFeatures").value;
            const how_to_use = document.getElementById("howtouse").value;

            const originalPrice =
              document.getElementById("originalPrice").value;
            const offeredPrice = document.getElementById("offeredPrice").value;
            const category = document.getElementById("category").value;
            const stock = document.getElementById("stock").value;
            const MainImage = document.getElementById("Image1").files[0];

            const parsedOriginalPrice = parseInt(originalPrice, 10);
            const parsedOfferedPrice = parseInt(offeredPrice, 10);

            const createdAt = getScheduledDateTime();

            if (parsedOfferedPrice >= parsedOriginalPrice) {
              showAlert("Enter a valid price", "danger");
              return;
            } else {
              if (
                name &&
                description &&
                skuCode &&
                FAQ &&
                keyFeatures &&
                metaTitle &&
                metaDescription &&
                how_to_use &&
                originalPrice &&
                offeredPrice &&
                category &&
                stock &&
                MainImage &&
                createdAt
              ) {
                let formData = new FormData();

                formData.append("name", name);
                formData.append("description", description);
                formData.append("skuCode", skuCode);
                formData.append("FAQ", FAQ);
                formData.append("meta_title", metaTitle);
                formData.append("meta_description", metaDescription);
                formData.append("keyFeatures", keyFeatures);
                formData.append("how_to_use", how_to_use);
                formData.append("newArrival", newArrival);
                formData.append("bestSeller", bestSeller);
                formData.append("originalPrice", originalPrice);
                formData.append("offeredPrice", offeredPrice);
                formData.append("category", category);
                formData.append("stock", stock);
                formData.append("imageFiles", MainImage);
                formData.append("createdAt", createdAt);

                for (let index = 0; index < 6; index++) {
                  if (document.getElementById(`Image${index + 2}`).files[0]) {
                    formData.append(
                      "imageFiles",
                      document.getElementById(`Image${index + 2}`).files[0]
                    );
                  }
                }

                await axios
                  .post("/api/products", formData)
                  .then((response) => {
                    showAlert("Product added successfully:", "success");
                    document.getElementById("productName").value = "";
                    document.getElementById("ProductSKUcode").value = "";
                    document.getElementById("productDescription").value = "";
                    document.getElementById("productFAQ").value = "";
                    document.getElementById("metaTitle").value = "";
                    document.getElementById("metaDescription").value = "";
                    document.getElementById("keyFeatures").value = "";
                    document.getElementById("howtouse").value = "";
                    document.getElementById("originalPrice").value = "";
                    document.getElementById("offeredPrice").value = "";
                    document.getElementById("category").value = "";
                    document.getElementById("stock").value = "";
                    document.getElementById("Image1").files[0] = "";
                    document.getElementById("Image2").files[0] = "";
                    document.getElementById("Image3").files[0] = "";
                    document.getElementById("Image4").files[0] = "";
                    document.getElementById("Image5").files[0] = "";
                    document.getElementById("Image6").files[0] = "";
                    document.getElementById("Image7").files[0] = "";

                    resetPreview();
                  })
                  .then(() => {
                    const myElement = document.getElementById("inventoryTab");

                    const myEvent = new Event("click");

                    myElement.dispatchEvent(myEvent);
                  })
                  .catch((error) => {
                    showAlert("Error adding product:", "danger");
                    console.log(error);
                  });
              } else {
                showAlert(
                  "Please fill in all the details before adding the product.",
                  "danger"
                );
              }
            }
          }
        </script>
      </div>
      <div id="inventory" style="display: none">
        <style>
          .item_edit_modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1;
          }

          .image_edit_modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 2;
          }

          .item_schedule_modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1;
          }

          .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 50vw;
            width: 100%;
            height: 90vh !important;
            overflow-y: scroll;
            height: max-content;
            text-align: left;
            position: relative;
          }

          .modal-content-schedule {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 50vw;
            width: 100%;
            overflow-y: scroll;
            height: max-content !important;
            text-align: left;
            position: relative;
          }

          .modal-content button {
            margin-top: 1vh;
            background-color: green;
            padding: 1vh;
            color: #fff;
            cursor: pointer;
            border-radius: 5px;
          }

          .modal-content div {
            margin-top: 1vh;
            display: flex;
            justify-content: space-between;
          }

          .modal-content .new-addon-images div {
            width: 32%;
            display: flex;
            flex-direction: column;
          }

          .modal-content .new-addon-images label {
            font-size: 14px;
          }

          .modal-content input {
            padding: 1vh;
            border-radius: 1vh;
            width: 50%;
            border: 1px solid #000;
          }

          .modal-content select {
            padding: 1vh;
            border-radius: 1vh;
            width: 50%;
            border: 1px solid #000;
          }

          .modal-content textarea {
            padding: 1vh;
            border-radius: 1vh;
            width: 50%;
            border: 1px solid #000;
          }

          .modal-content label {
            padding: 1vh;
            padding-left: 0;
            border-radius: 1vh;
            width: 50%;
          }
        </style>

        <div>
          <h1>Products Grid</h1>
          <div class="product-grid" id="productGrid"></div>

          <div id="editModal" class="item_edit_modal" style="display: none">
            <div class="modal-content">
              <span
                class="close"
                onclick="closeEditModal()"
                style="
                  cursor: pointer;
                  position: absolute;
                  top: 1vh;
                  right: 1vh;
                "
                >&#9587;</span
              >
              <h2>Edit Product</h2>
              <div>
                <label for="newName">Product Name:</label>
                <input
                  type="text"
                  id="newName"
                  name="newName"
                  required
                  aria-describedby="newNameError"
                />
                <span id="newNameError" class="error-message"></span>
              </div>
              <div>
                <label for="newDescription">Product Description:</label>
                <textarea
                  id="newDescription"
                  name="newDescription"
                  rows="5"
                  required
                ></textarea>
                <span id="newDescriptionError" class="error-message"></span>
              </div>
              <div>
                <label for="newProductSKUcode">Product Sku Code:</label>
                <input
                  type="text"
                  id="newProductSKUcode"
                  name="newProductSKUcode"
                  required
                  aria-describedby="newNameError"
                />
                <span id="newProductSKUcodeError" class="error-message"></span>
              </div>
              <div>
                <label for="newStock">New Stock:</label>
                <input
                  type="number"
                  id="newStock"
                  name="newStock"
                  required
                  aria-describedby="newStockError"
                />
                <span id="newStockError" class="error-message"></span>
              </div>
              <div>
                <label for="newOfferedPrice">New Offered Price:</label>
                <input
                  type="number"
                  id="newOfferedPrice"
                  name="newOfferedPrice"
                  required
                  aria-describedby="newOfferedPriceError"
                />
                <span id="newOfferedPriceError" class="error-message"></span>
              </div>
              <div>
                <label for="newOriginalPrice">New Original Price:</label>
                <input
                  type="number"
                  id="newOriginalPrice"
                  name="newOriginalPrice"
                  required
                  aria-describedby="newOriginalPriceError"
                />
                <span id="newOriginalPriceError" class="error-message"></span>
              </div>

              <div>
                <label for="newcategory">Category :</label>

                <select id="newcategory" name="newcategory" required>
                  <option value="Face Care">Face Care</option>
                  <option value="Hair Care">Hair Care</option>
                  <option value="Body Care">Body Care</option>
                  <option value="Beard Care">Beard Care</option>
                  <option value="Skin Care">Skin Care</option>
                </select>
              </div>

              <div>
                <label for="newKeyFeatures">Key Features:</label>
                <textarea
                  id="newKeyFeatures"
                  name="newKeyFeatures"
                  rows="5"
                  required
                ></textarea>
                <span id="newKeyFeatures" class="error-message"></span>
              </div>

              <div>
                <label for="newUse">How to Use:</label>
                <textarea
                  id="newUse"
                  name="newUse"
                  rows="5"
                  required
                ></textarea>
                <span id="newUse" class="error-message"></span>
              </div>

              <div>
                <label for="newFAQ">FAQ:</label>
                <textarea
                  id="newFAQ"
                  name="newFAQ"
                  rows="5"
                  required
                ></textarea>
                <span id="newFAQ" class="error-message"></span>
              </div>

              <div>
                <label for="newMetaTitle">Meta Title:</label>
                <textarea
                  id="newMetaTitle"
                  name="newMetaTitle"
                  rows="1"
                  required
                ></textarea>
                <span id="newMetaTitle" class="error-message"></span>
              </div>

              <div>
                <label for="newMetaDesc">Meta Description:</label>
                <textarea
                  id="newMetaDesc"
                  name="newMetaDesc"
                  rows="3"
                  required
                ></textarea>
                <span id="newMetaDesc" class="error-message"></span>
              </div>
              <div>
                <label for="newImages">Product Images:</label>
                <div id="productImages"></div>
              </div>
              <button onclick="updateData()">Save Changes</button>
            </div>
          </div>
        </div>
        <script>
          let selectedItemId = "";
          let imageDataForUpdation = {};

          async function updateData() {
            let formData = new FormData();

            formData.append("itemId", selectedItemId);
            formData.append("name", document.querySelector("#newName").value);
            formData.append(
              "skuCode",
              document.querySelector("#newProductSKUcode").value
            );
            formData.append(
              "description",
              document.querySelector("#newDescription").value
            );
            formData.append(
              "category",
              document.querySelector("#newcategory").value
            );
            formData.append(
              "keyFeatures",
              document.querySelector("#newKeyFeatures").value
            );
            formData.append("FAQ", document.querySelector("#newFAQ").value);
            formData.append(
              "meta_title",
              document.querySelector("#newMetaTitle").value
            );
            formData.append(
              "meta_description",
              document.querySelector("#newMetaDesc").value
            );
            formData.append("stock", document.querySelector("#newStock").value);
            formData.append(
              "offeredPrice",
              document.querySelector("#newOfferedPrice").value
            );
            formData.append(
              "originalPrice",
              document.querySelector("#newOriginalPrice").value
            );

            for (const index in imageDataForUpdation) {
              formData.append("imageFiles", imageDataForUpdation[index]);
              formData.append("imageFileIndexes", index);
            }

            await axios
              .put(`/api/products`, formData)
              .then((response) =>
                showAlert("Product data updated successfully", "success")
              )
              .catch((err) => {
                console.log(err);
                showAlert("Error updating the product", "danger");
              });
          }
          async function openEditModal(itemId) {
            selectedItemId = itemId;
            document.querySelector(".item_edit_modal").style.display = "flex";
            await axios
              .get(`/api/products/${itemId}`)
              .then((response) => response.data)
              .then((product) => {
                document.querySelector("#newName").value = product.name;
                document.querySelector("#newProductSKUcode").value =
                  product.skuCode;
                document.querySelector("#newDescription").value =
                  product.description;
                document.querySelector("#newcategory").value = product.category;
                document.querySelector("#newUse").value = product.how_to_use;
                document.querySelector("#newKeyFeatures").value =
                  product.keyFeatures;
                document.querySelector("#newFAQ").value = product.FAQ;
                document.querySelector("#newMetaTitle").value =
                  product.meta_title;
                document.querySelector("#newMetaDesc").value =
                  product.meta_description;
                document.querySelector("#newStock").value = product.stock;
                document.querySelector("#newOfferedPrice").value =
                  product.offeredPrice;
                document.querySelector("#newOriginalPrice").value =
                  product.originalPrice;

                product.imageLink.forEach((link, index) => {
                  let div = document.createElement("div");
                  let img = document.createElement("img");
                  img.src = link;
                  img.alt = "product image";
                  img.style.height = "120px";
                  img.style.width = "120px";

                  img.addEventListener("click", () => {
                    const input = document.createElement("input");
                    input.type = "file";
                    input.accept = "image/*";
                    input.onchange = (event) => {
                      const file = event.target.files[0];
                      const reader = new FileReader();
                      reader.onload = () => {
                        img.src = reader.result;
                        imageDataForUpdation[index] = file;
                        console.log(imageDataForUpdation);
                      };
                      reader.readAsDataURL(file);
                    };
                    input.click();
                  });
                  div.appendChild(img);
                  document.querySelector("#productImages").appendChild(div);
                });
              });
            document.querySelector("#newStock").value;
          }

          function closeEditModal() {
            selectedItemId = "";
            imageDataForUpdation = {};
            document.querySelector(".item_edit_modal").style.display = "none";
          }

          async function deleteProduct(itemId) {
            await axios
              .delete(`/api/products/${itemId}`)
              .then((response) => {
                document.querySelector("." + itemId).innerHTML = "";
                showAlert("product deleted successfully", "success");
              })
              .catch((err) =>
                showAlert(
                  "some error occured when removing the product",
                  "danger"
                )
              );
          }

          async function loadAllProducts() {
            document.querySelector(".product-grid").innerHTML = "";
            await axios
              .get("/api/products")
              .then((response) => response.data)
              .then((products) => {
                let mainGrid = document.querySelector(".product-grid");
                products.forEach((product, index) => {
                  let productDiv = document.createElement("div");

                  var words = product.name.split(" ");
                  product.name = words.slice(0, 3).join(" ");
                  if (words.length > 3) {
                    product.name += "...";
                  }
                  productDiv.innerHTML = `
                      <div class="product-card ${
                        product.itemId
                      }" style="text-transform:Capitalize;text-align:left;padding:1rem">
                          <img class="product-image" src="${
                            product.imageLink[0]
                          }" alt="Product 1">
                          <div class="product-name">${product.name}</div>
                          <div class="product-stock">Stock Left : ${
                            product.stock
                          }</div>
                          <div class="product-stock">Price : &#8377;${
                            product.originalPrice
                          }</div>
                          <div class="product-status">${
                            Date.parse(product.createdAt) >= Date.now()
                              ? "Scheduled"
                              : "Live"
                          }</div>
                          <div class="product-actions">
                              <button onclick="openEditModal('${
                                product.itemId
                              }')">Edit</button>
                              <button onclick="deleteProduct('${
                                product.itemId
                              }')">Delete</button>
                          </div>
                      </div>
                      `;
                  mainGrid.append(productDiv);
                });
                showAlert("All Products Loaded", "success");
              })
              .catch((err) =>
                showAlert("Error fetching products data", "danger")
              );
          }
          document
            .querySelector("#inventoryTab")
            .addEventListener("click", async () => {
              loadAllProducts();
            });
        </script>
      </div>
      <div id="coupons" style="display: none">
        <div>
          <h1>Add/Delete Coupons</h1>

          <div class="coupon-container">
            <form id="couponForm">
              <table>
                <tr>
                  <th>Coupon Code</th>
                  <th>Discount Percentage</th>
                  <th>Validity Start</th>
                  <th>Validity End</th>
                  <th>Action</th>
                </tr>
                <tr>
                  <td>
                    <input
                      type="text"
                      id="couponCode"
                      name="couponCode"
                      placeholder="Enter coupon Code"
                      required
                    />
                  </td>
                  <td>
                    <input
                      type="number"
                      id="discountPercentage"
                      name="discountPercentage"
                      placeholder="Enter discount percentage"
                      required
                      min="1"
                      max="100"
                      style="width: 15vw"
                    />
                  </td>
                  <td>
                    <input
                      type="datetime-local"
                      id="validityStart"
                      name="validityStart"
                      placeholder="Select validity start"
                      required
                    />
                  </td>
                  <td>
                    <input
                      type="datetime-local"
                      id="validityEnd"
                      name="validityEnd"
                      placeholder="Select validity end"
                      required
                    />
                  </td>
                  <td>
                    <button type="button" onclick="addCoupon()">
                      Add Coupon
                    </button>
                  </td>
                </tr>
              </table>
            </form>

            <div style="overflow: auto; height: 60vh">
              <h2 style="margin-top: 2rem">Active Coupons</h2>
              <table id="couponList">
                <thead>
                  <tr>
                    <th>Coupon Name</th>
                    <th>Discount Percentage</th>
                    <th>Validity Start</th>
                    <th>Validity End</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody class="couponsTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <script>
          async function addCoupon() {
            const code = document.querySelector("#couponCode").value;
            const discount = document.querySelector(
              "#discountPercentage"
            ).value;
            const validityStart =
              document.querySelector("#validityStart").value;
            const validityEnds = document.querySelector("#validityEnd").value;

            if (code && discount && validityStart && validityEnds) {
              await axios
                .post("/coupons", {
                  code,
                  discount,
                  validityStart,
                  validityEnds,
                })
                .then((response) => {
                  console.log(response);
                  let row = document.createElement("tr");
                  row.classList.add(`code_${coupon.code}`);
                  row.innerHTML = `
                      <tr>
                          <td>${code}</td>
                          <td>${discount}%</td>
                          <td>${validityStart}</td>
                          <td>${validityEnds}</td>
                          <td><button onclick="deleteCoupon('${code}')">Delete</button></th>
                      </tr>
                      `;
                  document.querySelector(".couponsTableBody").append(row);

                  document.querySelector("#couponCode").value = "";
                  document.querySelector("#discountPercentage").value = "";
                  document.querySelector("#validityStart").value = "";
                  document.querySelector("#validityEnd").value = "";

                  showAlert("coupon Added successfully", "success");
                })
                .catch((err) =>
                  showAlert("an error occured creating a coupon", "danger")
                );
            }
          }
          async function deleteCoupon(code) {
            await axios
              .delete(`/coupons/${code}`)
              .then((response) => {
                console.log(response.data.message);
                document.querySelector(`.code_${code}`).innerHTML = "";
                showAlert("coupon deleted successfully", "success");
              })
              .catch((err) => showAlert("failed to delete coupon ", "danger"));
          }
          document
            .querySelector("#couponTab")
            .addEventListener("click", async () => {
              await axios
                .get("/coupons")
                .then((response) => response.data)
                .then((coupons) => {
                  let body = document.querySelector(".couponsTableBody");
                  body.innerHTML = "";
                  coupons.forEach((coupon) => {
                    let row = document.createElement("tr");
                    row.classList.add(`code_${coupon.code}`);
                    row.innerHTML = `
                      <tr>
                          <td>${coupon.code}</td>
                          <td>${coupon.discount}%</td>
                          <td>${coupon.validityStart}</td>
                          <td>${coupon.validityEnds}</td>
                          <td><button onclick="deleteCoupon('${coupon.code}')">Delete</button></th>
                      </tr>
                      `;
                    body.append(row);
                    showAlert("coupons loaded successfully", "success");
                  });
                })
                .catch((err) =>
                  showAlert(
                    "an error occured while fetching the coupons",
                    "danger"
                  )
                );
            });
        </script>
      </div>
    </main>
    <script>
      let selectedSection = "collections";

      function selectSection(sectionName) {
        document.getElementById(selectedSection).style.display = "none";
        document.getElementById(sectionName).style.display = "block";
        selectedSection = sectionName;
      }
    </script>
  </body>
</html>
