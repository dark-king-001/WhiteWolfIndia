<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Admin Panel</title>
    <style>
      body {
        display: flex;
        flex-direction: row;
      }

      header {
        margin: 1em;
      }
    </style>
    <div id="alertContainer"></div>
    <style>
      .alert {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1;
        padding: 1vh 2vh;
        margin-bottom: 1rem;
        border: 2px solid transparent;
        text-transform: capitalize;
        border-radius: 5px;
        transition: 0.3s ease-in-out;
      }

      #graphSelect {
        padding: 1vh;
        border: 1px solid lightgrey;
        border-radius: 1vh;
        text-transform: uppercase;
      }

      .alert.success {
        color: #fff;
        background-color: green;
        border-color: #fff;
      }
      .alert.danger {
        color: #fff;
        background-color: maroon;
        border-color: #fff;
      }
    </style>
    <script>
      function showAlert(message, type) {
        const alertContainer = document.getElementById("alertContainer");

        const alert = document.createElement("div");
        alert.className = `alert ${type}`;
        alert.innerHTML = `${message}<span class="close" onclick="closeAlert(this)"> &#9587;</span>`;

        alertContainer.appendChild(alert);

        setTimeout(() => {
          closeAlert(alert.querySelector(".close"));
        }, 4000);
      }

      function closeAlert(closeButton) {
        const alert = closeButton.parentElement;
        alert.style.display = "none";
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li class="logo">
            <img src="/assets/ww side name logo.png" alt="" />
            <span class="nav-item admin">Admin Dashboard</span>
          </li>
          <li>
            <a
              href="#"
              onclick="selectSection('collections')"
              id="collectionsTab"
            >
              <i class="fas fa-user"></i>
              <span class="nav-item">collections</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="selectSection('addProducts')" id="productsTab">
              <i class="fas fa-user"></i>
              <span class="nav-item">add Products</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="selectSection('inventory')" id="inventoryTab">
              <i class="fas fa-user"></i>
              <span class="nav-item">Inventory</span>
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <main>
      <div id="collections" style="display: none">
        <div>
          <button id="collectionsCreate">Create New</button>
          <form id="collectionsForm" style="display: none">
            <input type="text" id="collectionName" placeholder="Name" />
            <input
              type="text"
              id="collectionDescription"
              placeholder="Description"
            />
            <button id="collectionsEnter">Enter</button>
            <button id="collectionsCancel">Cancel</button>
          </form>
          <table>
            <thead>
              <th>Name</th>
              <th>Description</th>
            </thead>
            <tbody id="collectionsTableBody"></tbody>
          </table>
        </div>
        <script>
          let collectionsEditMode = false;
          let collectionsEditId = "";

          document
            .getElementById("collectionsEnter")
            .addEventListener("click", () => {
              const name = document.getElementById("collectionName").value;
              const description = document.getElementById(
                "collectionDescription"
              ).value;

              if (collectionsEditMode) {
                axios
                  .put("/collections/" + collectionsEditId, {
                    name,
                    description,
                  })
                  .then((response) => {
                    collectionsEditId = "";
                    collectionsEditMode = false;
                    showAlert("collection updated successfully", "success");

                    loadCollections();
                  })
                  .catch((err) => console.log(err));
              } else {
                axios
                  .post("/collections", { name, description })
                  .then((response) => {
                    showAlert("collection created successfully", "success");
                    loadCollections();
                  })
                  .catch((err) => console.log(err));
              }
            });

          document
            .getElementById("collectionsCreate")
            .addEventListener("click", (event) => {
              event.preventDefault();

              document.getElementById("collectionsCreate").style.display =
                "none";
              document.getElementById("collectionsForm").style.display =
                "block";
            });
          document
            .getElementById("collectionsCancel")
            .addEventListener("click", (event) => {
              collectionsEditMode = false;
              collectionsEditId = "";

              event.preventDefault();
              document.getElementById("collectionsCreate").style.display =
                "block";
              document.getElementById("collectionsForm").style.display = "none";
            });

          async function loadCollections() {
            await axios
              .get("/collections")
              .then((response) => {
                const data = response.data;

                document.getElementById("collectionsTableBody").innerHTML = "";
                data.forEach((element) => {
                  let row = document.createElement("tr");

                  let name = document.createElement("td");
                  name.textContent = element.name;
                  row.append(name);

                  let description = document.createElement("td");
                  description.textContent = element.description;
                  row.append(description);

                  let edit = document.createElement("button");
                  edit.textContent = "edit";
                  edit.addEventListener("click", () => {
                    collectionsEditId = element._id;
                    collectionsEditMode = true;

                    document.getElementById("collectionsCreate").style.display =
                      "none";
                    document.getElementById("collectionsForm").style.display =
                      "block";
                    document.getElementById("collectionName").value =
                      element.name;
                    document.getElementById("collectionDescription").value =
                      element.description;
                  });
                  row.append(edit);

                  let deleteButton = document.createElement("button");
                  deleteButton.textContent = "delete";
                  deleteButton.addEventListener("click", () => {
                    axios
                      .delete("/collections/" + element._id)
                      .then(async (response) => {
                        showAlert("collection deleted successfully", "success");
                        loadCollections();
                      })
                      .catch((err) => console.log(err));
                  });
                  row.append(deleteButton);

                  document.getElementById("collectionsTableBody").append(row);
                });
              })
              .catch((err) => console.log(err));
          }
          document
            .getElementById("collectionsTab")
            .addEventListener("click", loadCollections());
        </script>
      </div>
      <div id="addProducts" style="display: none">
        <div></div>
        <script></script>
      </div>
      <div id="inventory" style="display: none">
        <div></div>
        <script></script>
      </div>
    </main>
    <script>
      let selectedSection = "collections";

      function selectSection(sectionName) {
        document.getElementById(selectedSection).style.display = "none";
        document.getElementById(sectionName).style.display = "block";
        selectedSection = sectionName;
      }
    </script>
  </body>
</html>
